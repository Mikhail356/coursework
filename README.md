# Описание работы проекта.
## Основные рабочие объекты:
1. __Страница ученого__ - html страница содержащая информацию о ученом, его соавторах и публикациях.
2. __Страница публикации__ - html страница содержащая информацию о публикации и ее авторах.
3. __Сервер__ - сервер, которым владеет определенное научное учреждение. На нем содержатся страницы ученых и их публикаций.
4. __Источник (source)__ - страница ученого/публикации с которой отправляют web интернет запросы.
5. __Цель (target)__ - страница ученого/публикации на которую поступают web интернет запросы.
4. __WebMention сервер__ - специальный сервер, который получает и записывает в _базу данных_ запросы от _серверов_ в определенном формате: URL адрес _source_ источника, URL адрес _target_ цели, URL адрес _WebMention сервера_. Отличается своей структурой от _сервера_, но также является собственностью соответствующего _серверу_ научного учреждения.
6. __База Данных (БД)__ - хранит записи в формате: URL адрес _source_ источника, URL адрес _target_ цели, время поступления запроса на _WebMention сервер_, URL адрес _WebMention сервера_. Является собственностью соответствующего _серверу_ и _WebMention серверу_ научного учреждения.

## Команды работы с проектом.
Команды для работы с уже __развернутой__ системой.
### Update обновление.
__Кратко__. На вход подается URL адрес страницы. Команда отпраляет все ссылки в ней на _WebMention сервер_, который записывает их в соответствующем формате в _БД_. Вызывается при каждом изменении _страницы_.
__Алгоритм работы:__
1. Отправить GET запрос на указанный URL адрес
2. Если ответ пришел без ошибок (с кодом 200), то перейти к следующему шагу. Иначе прекратить работу и вывести сообщение об ошибке.
3. Разобрать html код страницы, полученный на прошлом шаге.
4. Найти все ссылки на другие страницы и URL адрес WebMention сервера.
5. Отправить на URL адрес WebMention сервера POST запросы, содержащие:
    1. URL Адрес текущей страницы.
    2. URL Адрес целевой страницы.
    4. URL Адрес личного  WebMention сервера для сервера, содержащего текущую страницу.
6. Вывод URL адресов обновленных страниц на экран.

# Check проверка.
__Кратко__. На вход подается физический адрес .html файла страницы и ее URL адрес. Команда скачивает из _БД_ свои запросы, появившиеся после последней проверки, и редактирует существующую страницу в соответствии с ними. Редактирование происходит путем добавления и удаления новых ученых, публикаций, ссылок.
__Алгоритм работы:__
1. Считать из отдельного файла (назовем его _time_) время последнего обновления страницы.
2. Разобрать .html страницу на теги. 
3. Найти в разборе URL адрес _WebMention сервера_.
4. Считать из _БД_ все записи, посланные на данный _WebMention сервер_, имеющие целью текущую страницу, и появившиеся после даты последней проверки.
5. Отправить GET запросы на все страницы, запросы которых содержали целью текущую страницу.
6. Если результат запроса оказался удовлетворительным (вернулся с кодом 200) перейти к следующему пункту, иначе поместить данную страницу в список адресов страниц на удаление (с именем _remove_).
7. Провести проверку страницы на подлинность, в случае успеха перейти к следующему шагу, иначе поместить данную страницу в список адресов страниц на удаление (с именем _remove_).
8. URL адрес страницы поместить в массив адресов страниц для добавления (с именем _add_).
9. Найти в разборе текущей страницы все ссылки на другие страницы и поместить в массив _current_.
10. Если среди последних есть адреса страниц подлежащих удалению (находятся в _remove_), то сделать соответствующие виртуальные изменения в коде страницы.
11. Если в _current_ нет каких-то URL адресов из массива _add_, то сделать соответствующие виртуальные изменения в коде страницы.
12. Вывести на экран список изменений страницы и запросить пользователя разрешение на их внесение в физический код страницы.
13. В случае отказа завершить работу команды. Иначе провести изменения кода страницы.
14. Записать в файл _time_ время последнего обновления данной страницы.
15. Вызвать команду __Update__ __Обновления__, описанную выше.